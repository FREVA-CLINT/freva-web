{% extends "_layouts/menu.html" %}


{% block page_title %}History - Evaluation System{% endblock %}
{% block page_class %}home-page{% endblock %}



{% block content %}

{% load bootstrap3 %}
{% load dialogtags %}

{# Load CSS and JavaScript #}
{% bootstrap_javascript %}  

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.0/js/jquery.dataTables.min.js"></script>
    
    <script type="text/javascript" src="{{ STATIC_URL }}js/datatableview.js"></script>
    <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>

<style type="text/css">
.tooltip-inner {max-width: 650px; !important; }

.tooltip.left .tooltip-arrow{visibility: hidden;}

.datatable th{
    width:20px;
}

.datatable th[data-name="row-id"] {
    width : 70px;
}
.datatable th[data-name="user"] {
    width : 70px;
}
.datatable th[data-name="tool"] {
    width : 100px;
}
.datatable th[data-name="caption"] {
    width : 160px;
}
.datatable th[data-name="timestamp"] {
    width : 92px;
}
.datatable th[data-name="status"] {
    width : 90px;
}
.datatable th[data-name="info"] {
    width : 180px;
}
.editable{
    color: #000 !important; 
}

.blacktable{
	background:#000 !important;
}

html.wait, html.wait * { cursor: wait !important; }
</style>

<link rel="stylesheet" type="text/css" href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>


    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
        <div class="col-lg-12">
          <h2>History</h2>


          
    {{ datatable }}
        </div>

      </div>
          <div class="navbar-default" style="{margin-top:20px}">
          <form class="navbar-form navbar-left" role="delete">
             <input id="setflag" type="hidden" name="setflag" value="">
             <input id="rowids" type="hidden" name="rowids" value="">
             <a class="btn navbar-btn  btn-default" id="btn-delete">Delete</a>
             <a class="btn navbar-btn  btn-default" id="btn-select-all">Select all</a>  
	  </form>
          <form class="navbar-form navbar-right" role="form" action="{% url 'history:history' uid %}" method="get">
           <label for="filter_flag" class="control-label" style="{text-align:right;}">Filter entries:</label>
            <div class="form-group">
               <select id="filter_flag" class="form-control" name="flag">
                 <option value = "-1">non-deleted</option>
                 <option value = "3">deleted</option>
               </select>
            </div>
            <label for="filter_status" class="control-label" style="{text-align:right;}">Process Status:</label>
            <div class="form-group">
               <select id="filter_status" class="form-control" name="status">
                 <option value = "-1">All</option>
                 {% for status in STATUS_CHOICES %}
                 <option value = "{{status.0}}">{{status.1}}</option>
                 {% endfor %}
               </select>
            </div> <!-- end of form-group -->
            <button type="submit" class="btn btn-default navbar-btn">Filter</button>
          </form>
          </div> <!-- navbar -->

      <hr>
   </div>

{# Render a Bootstrap password/cancel dialog #}
{% cancel_dialog %}
	 
<!-- Modal Passwort Dialog-->
  <div class="modal fade" id="myModalPw" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Enter password</h4>
        </div>
        <div class="modal-body" id="browsefield">
          	
        	<div class="form-group">
        		<p class="help-block">To schedule the analysis you have to re-enter your password</p>
				<input id="password_temp" class="form-control" type="password" name="password_temp" style="width: 90%;">
				<input id="button_id" class="form-control" type="hidden" name="button_id" style="width: 90%;">
			</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submit_analysis">Submit analysis</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
 
	 
<script>
datatableview.auto_initialize = false;

function initTooltips(){
    // for re-drawing (previous, next) this line is needed
   $('.ttbtn').tooltip({html:true});
   console.log('drawing');
   $('.ttbtn').hover(function(){
      $('.tooltip').css('top', -110 + 'px')
    });
}

function changeCursor(e, settings, processing){
	console.log(e, settings, processing);
};

$(document).ready(function() {

// Page javascript
datatableview.auto_initialize = false;
$(function(){
    var xeditable_options = {};
    datatableview.initialize($('.datatable'), {
        
        fnRowCallback: datatableview.make_xeditable(xeditable_options),
        drawCallback: function(){initTooltips()},
    });
})

    // the very first initialization needs this line of code
    $('.ttbtn').tooltip({html:true});
		
	$('.datatable')
    .on( 'processing.dt', function ( e, settings, processing ) {
    	if(processing)
    		$('html').addClass('wait');
    	else
    		$('html').removeClass('wait');
        $('#processingIndicator').css( 'display', processing ? 'block' : 'none' );
    } )	

    // Script for the password modal
    // set focus to pw-field
    $('#myModalPw').on('shown.bs.modal', function () {
        $('#password_temp').focus();
    })

   $('#btn-select-all').on('click', function(){
       if($(this).text() == 'Select all'){
            $('.chksel').prop('checked', true);
            $(this).text('Unselect all');
       
       }else{
	    $('.chksel').prop('checked', false);
            $(this).text('Select all');
       }
   });

   $('#btn-delete').on('click', function(){
            var rowids = new Array();

            $("input:checkbox.chksel").each(function () {
                   if(this.checked) rowids.push(this.id.substring(3));
            });

           var url = '{% url 'history:changeFlag' %}';

           var flag = 0;

           if($('#btn-delete').text() == 'Delete') {
               flag = 3;
           }

           $('#rowids').val(rowids);

           data = {'ids' : JSON.stringify(rowids), 'flag' : flag};

           $.post(url, data, function(resp) {if(resp != '') alert(resp);
             $('#DataTables_Table_0').dataTable().fnClearTable()
             $('#DataTables_Table_0').dataTable().fnDraw();
	   });

    });

//    $('.btn-cancel').on('click', function(){
//            var id = this.id;
//            alert("click!");
//            cancelDialog.show(id.split('cancelButton_')[1]);
//    });

    $('.ttbtn').hover(function(){
        $('.tooltip').css('top', -110 + 'px')
    //    $('.tooltip').css('top',parseInt($('.tooltip').css('top')) + 0 + 'px')
    });

    $('#filter_flag').val("{{flag}}");
    $('#filter_status').val("{{status}}");
    
    if({{flag}} == 3) {
       $('#btn-delete').text('Undelete');
    }
    else {
       $('#btn-delete').text('Delete');
    }
} );

</script>



{% endblock %}

{% block media %}

    
{% endblock %}-->

 
<!--history_list.backup
{# mymodel_list.html #}



