{% extends "_layouts/menu.html" %}

{% block page_title %}{{ history_object.tool|title }} results - Evaluation System{% endblock %}
{% block page_class %}home-page{% endblock %}
{% block content %}
<!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

{% load resulttags %}       


    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
	      <div class="col-md-12">
	      	<h1>{{ history_object.tool|capfirst }}</h1>
	      	<p>Analysis from {{ history_object.timestamp|date:"d.m.y H:i:s" }} done by <a href="{% url 'history:history' %}?uid={{history_object.uid}}">{{history_object.uid}}</a></p>
	      </div>
      </div>
      <div class="row">
	 	 	<div class="col-md-12">
	 	 		<a class="btn btn-primary" onClick="toogleConfig('config_table');" id="config_button">Show configuration</a>
	 	 		<a class="btn btn-primary" href="{% url 'plugins:setup' history_object.tool history_object.id%}" id="config_button">Edit configuration</a>
	 	 		{% if documentation %}
	 	 			<a class="btn btn-success" href="{{documentation.url}}">Documentation</a>
	 	 		{%endif%}
	 	 	</div>
	 	 	<div class="col-md-12">
		 	 	<table class="table col-md-12" id="config_table" style="display:none; margin-top:10px;">
		 	 	{% for key,value in history_object.config_dict.items %}
		 	 		<tr>
		 	 			<td>{{key}}:</td>
		 	 			<td>{{value}}</td>
		 	 		</tr>
		 	 	{% endfor %}
		 	 	</table>
	 	 	</div>
	  </div>
      {% if file_content %}
      <script>
      function doUpdate() {
      
		  var tailServiceUrl = '{% url 'history:tailFile' history_object.id %}';
		  $.ajax({type: "GET", url : tailServiceUrl,
		          success: function (data) {
		             if (!data)
		             {
		                console.log(data)
                        window.location.reload(true)
                     }
		             if (data.length > 0)
		             {
		                var output = '';
		                console.log(data)
		                $.each(data, function(index,value){
		                	output += value;
		                });
		                $("#logOutputDiv").append(output);
		                $('#logOutputDiv').stop().animate({
						  scrollTop: $("#logOutputDiv")[0].scrollHeight
						}, 800);
		             }
		             setTimeout("doUpdate()", 2000);
		           }});
		}
		setTimeout("doUpdate()", 2000);
		</script>
      
	      <div class="row">
	        <div class="col-md-12">
	        	<p>The tool is still running. Here you can see the output:</p>
		        <div id="logOutputDiv" class="well well-lg" style="height:450px; overflow-y:scroll; overflow-x: hidden;">
	
		        {% for line in file_content %}
		        
		        	{{line}}<br>
		        
		        {%endfor%}
		        
		        </div>
	        </div>
	      </div>
	  
	  {%else%}
	  	  
	  
	    <div class="row">	   
	 	 {%if result_object  >= 0 %}
		 	
		 	 	<div class="col-md-12">
		 	 		<h2>Results</h2>
		 	 	</div>
		 	 	
		 	 	{% if history_object.status == history_object.processStatus.finished_no_output %}
		 	 		<div class="col-md-3">
		 	 			<p>There was no output produced!</p>
		 	 		</div>
		 	 	{%elif result_object.count == 0 %}
		 	 		<div class="col-md-3">
		 	 			<p>{{history_object.tool}} produced no plots.</p>
		 	 		</div>

	  <div class="col-md-12">
	  <h2><br>Files created:</h2>
	  <ul >
	  {{ file_list|unordered_list }}
	  </ul>
	  </div>
		 	 	{%else%}
		 	 	<!--
			 	 	{% for r_item in result_object %}
				        <div class="col-md-3">
				        	<a rel="gallery1" class="thumbnail fancybox" href="{{ PREVIEW_URL }}{{r_item.preview_file}}" title="{{r_item.output_file}}">
								<img src="{{ PREVIEW_URL }}{{r_item.preview_file}}" alt="{{r_item.output_file}}" />
							</a>
						</div>
			 	 	{% endfor %}
				-->
		     </div>
	   

	  <div class="row">
	  <div class="col-md-12">

	  <ul class="jqueryFileTree">
	  {{ file_list|preview_tree }}
	  </ul>
	  </div>
			 	{%endif%}
	      {%else%}
	      </div>
	      <div class="row">
	      	 <div class="col-md-12">
	      	 	<p>Process status is <strong>{{ history_object.status_name }}</strong><br/>Because you did not use batchmode we can't display any information</p>
	      	 </div>
	        
	  	  {%endif%}
		</div> 
	  {%endif%}

</div>
<script>
  	function toogleConfig(id){
  		
  		if($('#'+id).is(":hidden")){
  			$('#'+id).show();
  			$('#config_button').html('Hide configuration');
  		}else{
  		  	$('#'+id).hide();
  		  	$('#config_button').html('Show configuration');
  		}
  	}
  	
	$(document).ready(function() {
		
		$("img.lazy").lazyload({
		    effect : "fadeIn"
		});
	
		$('.jqueryFileTree a').on('click', function(target){
			var list_el = $(target.target).parent();
			list_el.toggleClass("expanded");
			list_el.toggleClass("collapsed");
			//activate fancybox link
			if(list_el.hasClass('fancybox'))
				return true;
			
			//toogle all child elements	
			var next_list = $(target.target).next();	
			$(next_list.children()).toggle();			

			return false; //don't activate the link
		});	
		
		$(".fancybox").fancybox({
			openEffect	: 'none',
			closeEffect	: 'none'
		});

	});
</script>

{% endblock %}
