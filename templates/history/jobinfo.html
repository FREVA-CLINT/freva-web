{% extends "_layouts/menu.html" %}

{% block page_title %}{{ history_object.tool }} results - Evaluation System{% endblock %}
{% block page_class %}home-page{% endblock %}
{% block content %}
<!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

{% load bootstrap3 %}
{% load dialogtags %}

{# Load CSS and JavaScript #}
{% bootstrap_javascript %}       


    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
	      <div class="col-md-12">
	      	<h1>{{ history_object.tool }}</h1>
	      	<p>Analysis from {{ history_object.timestamp|date:"d.m.y H:i:s" }} done by <a href="{% url 'history:history' %}?uid={{history_object.uid}}">{{history_object.uid}}</a></p>
	      </div>
      </div>
      <div class="row">
	 	 	<div class="col-md-12">
	 	 		<a class="btn btn-primary" onClick="toogleConfig('config_table');toogleConfig('copy_button');" id="config_button">Show configuration</a>
	 	 		<a class="btn btn-primary" href="{% url 'plugins:setup' history_object.tool history_object.id%}" id="config_button">Edit configuration</a>
	 	 		{% if history_object.status > 2 and history_object.slurm_output != 0%}
	 	 			
	 	 			<a class="btn btn-danger mybtn-cancel" id="cancelButton_{{h_item.id}}" onClick="cancelDialog.show({{history_object.id}})">Cancel job</a>
	 				{# Render a Bootstrap password/cancel dialog #}
	 	 			{% cancel_dialog %}
	 	 		
	 	 		{%endif%}
	 	 	
	 	 	
	 	 	</div>
	 	 	<div class="col-md-12">
		 	 	<table class="table col-md-12" id="config_table" style="display:none; margin-top:10px;">
		 	 	{% for key,value in history_object.config_dict.items %}
		 	 		<tr>
		 	 			<td>{{key}}:</td>
		 	 			<td>{{value}}</td>
		 	 		</tr>
		 	 	{% endfor %}
		 	 	</table>
	 	 		<a class="btn btn-info" onClick="window.prompt('Copy to clipboard: Ctrl+C, Enter', '{{analyze_command | escapejs}}');" id="copy_button" style="display:none; margin-bottom:10px;">Copy analyze command</a>
	 	 	</div>
	  </div>
      {% if history_object.status > 2 %}
      <script>
      function doUpdate() {
      
		  var tailServiceUrl = '{% url 'history:tailFile' history_object.id %}';
		  $.ajax({type: "GET", url : tailServiceUrl,
		          success: function (data) {
		             if (!data)
		             {
		                console.log(data)
                        window.location.reload(true)
                     }
		             if (data.length > 0)
		             {
		                var output = '';
		                console.log(data)
		                $.each(data, function(index,value){
		                	output += value;
		                });
		                $("#logOutputDiv").append(output);
		                $('#logOutputDiv').stop().animate({
						  scrollTop: $("#logOutputDiv")[0].scrollHeight
						}, 800);
		             }
		             setTimeout("doUpdate()", 2000);
		           }});
		}
		setTimeout("doUpdate()", 2000);
		</script>
              {% endif %}
	      <div class="row">
	        <div class="col-md-12">
                        {% ifnotequal history_object.slurm_output '0'%}
	        	<p>Contents of file  {{history_object.slurm_output}}:</p>
                        {%else%}
                        <p>Status:</p>
                        {%endifnotequal%}
		        <div id="logOutputDiv" class="well well-lg" style="height:450px; overflow-y:scroll; overflow-x: hidden;">
	
		        {% for line in file_content %}
		        
		        	{{line}}<br>
		        
		        {%endfor%}
		        
		        </div>
	        </div>
	      </div>


<script>
  	function toogleConfig(id){
  		
  		if($('#'+id).is(":hidden")){
  			$('#'+id).show();
  			$('#config_button').html('Hide configuration');
  		}else{
  		  	$('#'+id).hide();
  		  	$('#config_button').html('Show configuration');
  		}
  	}
  	
	$(document).ready(function() {
	    $("#btn_clipboard").click(
	    function copyToClipboard(text) {
  			window.prompt("Copy to clipboard: Ctrl+C, Enter", {{analyze_command}});
		}
	    );
		$(".fancybox").fancybox({
			openEffect	: 'none',
			closeEffect	: 'none'
		});
		$('#logOutputDiv').scrollTop($("#logOutputDiv")[0].scrollHeight);
	});
	
	
	
</script>

{% endblock %}
