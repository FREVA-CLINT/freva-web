{% extends "_layouts/menu.html" %}


{% block page_title %}History - Evaluation System{% endblock %}
{% block page_class %}home-page{% endblock %}
{% block content %}

{% load bootstrap3 %}
{% load dialogtags %}

{# Load CSS and JavaScript #}
{% bootstrap_javascript %}  

<link rel="stylesheet" type="text/css" href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>

    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
        <div class="col-lg-12">
          <h2>History</h2>
          
          <table class="table table-hover" id="dataTable">
          	<thead >
          	<tr>
          		<th>Row Id</th><th>Tool</th><th>Version</th><th>Timestamp</th><th>Status</th><th>&nbsp;</th>
          	</tr>
          	</thead>
          	<tbody>
          {% for h_item in history %}
          	<tr>   		
          			<td>{{h_item.id}}</td>
          			<td>{{h_item.tool}}</td>
          			<td>{{h_item.version}}</td>
          			<td>{{h_item.timestamp}}</td>
          			<td>{{ h_item.status_name }}</td>
          			<td>
          			{% if h_item.status == h_item.processStatus.finished %}
	          			<a class="btn btn-success btn-sm" href="{% url 'history:results' h_item.id %}">Show Results</a>
	          			<a class="btn btn-success btn-sm" href="{% url 'plugins:setup' h_item.tool h_item.id%}">Edit Config</a>
	          		{% endif %}
	          		{% if h_item.status == h_item.processStatus.running %}
	          			<a class="btn btn-success btn-sm" href="{% url 'history:results' h_item.id %}">Show Progress</a>
	          			{% ifnotequal h_item.slurm_output '0' %}
	          				<a class="btn btn-danger btn-sm mybtn-cancel" id="cancelButton_{{h_item.id}}">Cancel job</a>
	          			{%endifnotequal%}
	          		{% endif %}
	          		{% if h_item.status == h_item.processStatus.scheduled %}
	          			<a class="btn btn-success btn-sm" href="{% url 'plugins:setup' h_item.tool h_item.id%}">Edit Config</a>
	          			{% ifnotequal h_item.slurm_output '0' %}
	          				<a class="btn btn-danger btn-sm mybtn-cancel" id="cancelButton_{{h_item.id}}">Cancel job</a>
	          			{%endifnotequal%}
	          		{% endif %}
	          		{% if h_item.status == h_item.processStatus.broken %}
	          			<a class="btn btn-success btn-sm" href="{% url 'history:results' h_item.id %}">Show Report</a>
	          			<a class="btn btn-success btn-sm" href="{% url 'plugins:setup' h_item.tool h_item.id%}">Edit Config</a>

	          		{% endif %}
	          		{% if h_item.status == h_item.processStatus.finished_no_output %}
	          			<a class="btn btn-success btn-sm" href="{% url 'history:results' h_item.id %}">Show Report</a>
	          			<a class="btn btn-success btn-sm" href="{% url 'plugins:setup' h_item.tool h_item.id%}">Edit Config</a>
	          		{% endif %}
	          		{%ifnotequal h_item.slurm_output '0'%}
	          		<a class="btn btn-primary btn-sm ttbtn" href="{% url 'history:jobinfo' h_item.id%}" data-toggle="tooltip" data-placement="auto right"
	          		 title="Information to scheduled job<br><br>Configuration:<br> <div class='col-md-12'>
					 	 	<table class='table col-md-12' style='display:none; margin-top:10px;'>
		 				 	{% for key,value in history_object.config_dict.items %}
		 	 				<tr>
		 	 				<td>{{key}}:</td>
		 	 				<td>{{value}}</td>
		 	 				</tr>
		 	 				{% endfor %}
		 	 				</table>
	 	 				</div>">Info</a>
	 	 				
	          		 
                                {%else%}
	          		<a class="btn btn-info btn-sm ttbtn" href="{% url 'history:jobinfo' h_item.id%}" data-toggle="tooltip" data-placement="auto right"  title="Restricted information to manually started job&#10;&#10;Configuration:&#10;{{h_item.config_dict}}">info</a>
                                {%endifnotequal%}
	          		</td>
          	</tr>
          	
          {% endfor %}	  
          </tbody>       	
          </table>	
        </div>

      </div>

      <hr>
	 </div>

{# Render a Bootstrap password/cancel dialog #}
{% cancel_dialog %}
	 
<!-- Modal Passwort Dialog-->
  <div class="modal fade" id="myModalPw" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Enter password</h4>
        </div>
        <div class="modal-body" id="browsefield">
          	
        	<div class="form-group">
        		<p class="help-block">To schedule the analysis you have to re-enter your password</p>
				<input id="password_temp" class="form-control" type="password" name="password_temp" style="width: 90%;">
				<input id="button_id" class="form-control" type="hidden" name="button_id" style="width: 90%;">
			</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submit_analysis">Submit analysis</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
 
	 
<script>

$(document).ready(function() {
    $('#dataTable').dataTable({
    	"aaSorting": [[0,'desc']]
    });
  
    // the very first initialization needs this line of code
    $('.ttbtn').tooltip({html:true});
		
    // for re-drawing (previous, next) this line is needed
    $('#dataTable').on('draw', function() {$('.ttbtn').tooltip({html:true})});
    
} );

// Script for the password modal
// set focus to pw-field
$('#myModalPw').on('shown.bs.modal', function () {
    $('#password_temp').focus();
})

$('.mybtn-cancel').on('click', function(){
	var id = this.id;
	cancelDialog.show(id.split('cancelButton_')[1]);
});


</script>

{% endblock %}

 
