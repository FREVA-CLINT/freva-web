{% load static %} 
 
  <!-- Modal Passwort Dialog-->
  <div class="modal fade" id="myModalInfo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">{{caption}}</h4>
        </div>
        <div class="modal-body" id="waitingCancel">
        	<p>Here you can plugin your own plugin</p>
        	<div class="btn-group" data-toggle="buttons" style='margin-bottom:20px'>
            <label class="btn btn-primary active">
                <input type="radio" name="browse_options" id="browse_home" value="home" checked>Home
            </label>
            {% if user_scratch %}
            <label class="btn btn-primary">
                <input type="radio" name="browse_options" id="browse_scratch" value="scratch">Scratch
            </label>
            {% endif %}
            </div>       
            <div id="browsefield">
              ...
            </div>
            
            <form method="post" action="{%url 'plugins:export_plugin' %}" id="export_form">
                {% csrf_token %}        
                <div class="form-group" style="margin-top:15px;">
                  <label for="exampleInputEmail1">File to plugin</label>
                  <input required type="text" class="form-control" id="export_file" name="export_file" placeholder="Plugin File">
                </div>
            </form>
            
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" name="okBtn" id="okBtn">Export Plugin</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  
<script>
	$(document).ready(function(){
		$('#okBtn').on('click', function(){
			// post the form
			if($('#export_file').val() != '')
			   $('#export_form').submit();
		});
	
        activate_browse('{{user_home}}');
    
    
        $("input:radio[name='browse_options']").on('change', function () {
            kind = $( "input:radio[name='browse_options']:checked" ).val();
    
            if(this.value==kind)
            {
                if(kind=='scratch'){
                     activate_browse('{{user_scratch}}');
                }
                else {
                    activate_browse('{{user_home}}');
                }
            }
        });
    });   
    
function activate_browse(dir){
    $('#browsefield').fileTree({
        root : dir,
        script: '{% url 'plugins:dirlist' %}?file_type=py',
        expandSpeed: 100,
        collapseSpeed: 100,
        multiFolder: false
    }, function(file) {
        console.log(file);
        var sender = $('#senderField').val();
        $('#export_file').val(file);
        $('#myModal').modal('hide');

    });
}
</script>
